<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TSG Support</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Inter;background:#0b1120;color:#fff}

.sidebar{
 position:fixed;width:240px;height:100%;
 background:#020617;padding:20px;
}
.logo{font-size:20px;font-weight:600;margin-bottom:25px}

.nav button{
 width:100%;padding:12px;margin-bottom:8px;
 border:none;background:none;color:#94a3b8;
 border-radius:8px;text-align:left;cursor:pointer;
}
.nav button.active,.nav button:hover{
 background:#1e293b;color:#fff;
}

.main{margin-left:240px;padding:25px;animation:fade 0.4s}

.header{font-size:26px;margin-bottom:20px}

.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
 gap:15px;margin-bottom:20px;
}

.stat{
 background:#1e293b;padding:15px;border-radius:12px;
 text-align:center;
}

.card{
 background:#1e293b;padding:20px;border-radius:12px;
 margin-bottom:15px;transition:.2s;
}
.card:hover{transform:translateY(-4px)}

input,textarea{
 width:100%;padding:12px;margin-top:10px;
 border:none;border-radius:8px;
 background:#0f172a;color:white;
}

button{
 margin-top:10px;padding:10px;
 border:none;border-radius:8px;
 background:#3b82f6;color:white;
 cursor:pointer;
}

.status{font-weight:600}
.open{color:#ef4444}
.progress{color:#f59e0b}
.resolved{color:#22c55e}

.badge{
 background:#22c55e;
 padding:3px 8px;
 border-radius:6px;
 font-size:12px;
 margin-left:6px;
}

.comment{
 background:#0f172a;
 margin-top:6px;
 padding:6px;
 border-radius:6px;
}

.toast{
 position:fixed;
 bottom:20px;
 right:20px;
 background:#3b82f6;
 padding:10px 15px;
 border-radius:8px;
 opacity:0;
 transition:.3s;
}

@keyframes fade{
 from{opacity:0;transform:translateY(10px)}
 to{opacity:1}
}
</style>
</head>

<body>

<div class="sidebar">
 <div class="logo">TSG Support</div>

 <div class="nav">
  <button onclick="nav('home',this)" class="active">Dashboard</button>
  <button onclick="nav('reports',this)">Reports</button>
  <button onclick="nav('admin',this)">Admin</button>
 </div>
</div>

<div class="main">

<!-- HOME -->
<div id="home">
 <div class="header">Dashboard</div>

 <div class="grid">
  <div class="stat" id="total">Total: 0</div>
  <div class="stat" id="open">Open: 0</div>
  <div class="stat" id="resolved">Resolved: 0</div>
 </div>

 <div class="card">
  <h3>Create Report</h3>
  <input id="user" placeholder="Username">
  <textarea id="text" placeholder="Describe issue"></textarea>
  <button onclick="submit()">Submit</button>
 </div>
</div>

<!-- REPORTS -->
<div id="reports" style="display:none">
 <div class="header">Reports</div>
 <div id="list"></div>
</div>

<!-- ADMIN -->
<div id="admin" style="display:none">
 <div class="header">Admin</div>
 <input id="code" placeholder="Enter admin code">
 <button onclick="login()">Login</button>
 <div id="adminBox" style="display:none">Admin Enabled</div>
</div>

</div>

<div id="toast" class="toast"></div>

<script>
// Firebase
const firebaseConfig = {
 apiKey:"AIzaSyCPIfra8YuSnh9C5NbglpRdg4KE5aigHDI",
 authDomain:"support-32682.firebaseapp.com",
 projectId:"support-32682"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

// State
let admin=false;
const support=["timmy","admin","support"];

// Save username
if(localStorage.user) document.getElementById("user").value=localStorage.user;

// Navigation
function nav(page,btn){
 document.querySelectorAll(".main > div").forEach(d=>d.style.display="none");
 document.getElementById(page).style.display="block";
 document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
 btn.classList.add("active");
}

// Toast
function toast(msg){
 const t=document.getElementById("toast");
 t.innerText=msg;
 t.style.opacity=1;
 setTimeout(()=>t.style.opacity=0,2000);
}

// Submit
function submit(){
 const user=document.getElementById("user").value||"Anonymous";
 const text=document.getElementById("text").value;
 if(!text)return;

 localStorage.user=user;

 db.collection("reports").add({
  user,text,status:"open",
  support:support.includes(user),
  comments:[]
 });

 toast("Report submitted");
 document.getElementById("text").value="";
}

// Load reports
db.collection("reports").onSnapshot(snap=>{
 let html="";
 let total=0,open=0,res=0;

 snap.forEach(doc=>{
  total++;
  const r=doc.data();

  if(r.status==="open") open++;
  if(r.status==="resolved") res++;

  let cls="open";
  if(r.status==="in progress") cls="progress";
  if(r.status==="resolved") cls="resolved";

  html+=`
  <div class="card">
   <b>${r.user}</b> ${r.support?'<span class="badge">Support</span>':''}
   <div class="status ${cls}">${r.status}</div>
   <p>${r.text}</p>

   <button onclick="comment('${doc.id}')">Comment</button>

   ${admin?`
   <button onclick="update('${doc.id}','in progress')">Progress</button>
   <button onclick="update('${doc.id}','resolved')">Resolve</button>
   <button onclick="del('${doc.id}')">Delete</button>`:''}

   ${(r.comments||[]).map(c=>`
     <div class="comment">${c.user}: ${c.text}</div>
   `).join("")}
  </div>`;
 });

 document.getElementById("list").innerHTML=html;
 document.getElementById("total").innerText="Total: "+total;
 document.getElementById("open").innerText="Open: "+open;
 document.getElementById("resolved").innerText="Resolved: "+res;
});

// Comment
function comment(id){
 const user=prompt("Username");
 const text=prompt("Comment");
 if(!text)return;

 const ref=db.collection("reports").doc(id);
 ref.get().then(d=>{
  let c=d.data().comments||[];
  c.push({user,text});
  ref.update({comments:c});
  toast("Comment added");
 });
}

// Admin
function login(){
 if(document.getElementById("code").value==="6118"){
  admin=true;
  document.getElementById("adminBox").style.display="block";
  toast("Admin enabled");
 }
}

// Admin actions
function update(id,s){
 db.collection("reports").doc(id).update({status:s});
}
function del(id){
 db.collection("reports").doc(id).delete();
}
</script>

</body>
</html>
