<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TSG Discord Support</title>
<style>
body { font-family: Arial, sans-serif; margin:20px; background:#f4f4f4; color:#333; }
h1,h2,h3 { color:#222; }
textarea,input,select { width:100%; padding:10px; margin:5px 0; }
button { padding:8px 12px; margin:5px; cursor:pointer; }
.report { border:1px solid #ccc; padding:10px; margin:10px 0; background:#fff; border-radius:5px; }
.comment { margin-left:20px; background:#eef; padding:5px; border-radius:4px; margin-top:5px; }
.badge { background:green; color:white; padding:2px 6px; border-radius:4px; font-size:12px; margin-right:5px; }
#adminPanel { border:2px solid #333; padding:15px; background:#ddd; border-radius:6px; margin-top:20px; display:none; }
.status-open { color:red; font-weight:bold; }
.status-in-progress { color:orange; font-weight:bold; }
.status-resolved { color:green; font-weight:bold; }
</style>
</head>
<body>

<h1>TSG Discord Support</h1>

<h2>Submit a Report</h2>
<input type="text" id="username" placeholder="Enter your username"><br>
<textarea id="reportInput" placeholder="Write your report..." rows="4"></textarea><br>
<button onclick="submitReport()">Submit Report</button>

<hr>

<h2>Reports</h2>
<div id="reports"></div>

<hr>

<h2>Admin Panel</h2>
<input type="password" id="adminCode" placeholder="Enter admin code">
<button onclick="loginAdmin()">Login</button>

<div id="adminPanel">
  <h3>Admin Controls</h3>
  <button onclick="markSelected('in progress')">Mark Selected In Progress</button>
  <button onclick="markSelected('resolved')">Mark Selected Resolved</button>
  <button onclick="deleteSelected()">Delete Selected</button>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  // ===== Firebase Config =====
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let isAdmin = false;
  const supportUsers = ["SupportUser1","SupportUser2"]; // verified support usernames

  // ===== Submit Report =====
  function submitReport() {
    const username = document.getElementById("username").value.trim() || "Anonymous";
    const text = document.getElementById("reportInput").value.trim();
    if(!text) return alert("Write a report first!");
    const isSupport = supportUsers.includes(username);

    const newRef = db.ref('reports').push();
    newRef.set({
      id: newRef.key,
      username,
      text,
      support: isSupport,
      status: "open",
      comments: []
    });

    document.getElementById("reportInput").value = "";
    document.getElementById("username").value = "";
  }

  // ===== Listen for report changes =====
  db.ref('reports').on('value', snapshot => {
    const data = snapshot.val();
    renderReports(data);
  });

  function renderReports(data) {
    const container = document.getElementById("reports");
    container.innerHTML = "";
    if(!data) return;

    Object.values(data).forEach(r => {
      const div = document.createElement("div");
      div.className = "report";
      div.id = "r"+r.id;

      let statusClass = "status-open";
      if(r.status==="in progress") statusClass = "status-in-progress";
      if(r.status==="resolved") statusClass = "status-resolved";

      div.innerHTML = `
        <input type="checkbox" class="selectReport" data-id="${r.id}" style="display:${isAdmin?'inline-block':'none'}">
        <b>${r.username}</b> ${r.support?'<span class="badge">Support</span>':''} â€” <span class="${statusClass}">${r.status}</span><br>
        ${r.text}<br>
        <button onclick="addComment('${r.id}')">Comment</button>
        <div id="comments${r.id}"></div>
      `;

      container.appendChild(div);

      const commentsDiv = document.getElementById("comments"+r.id);
      commentsDiv.innerHTML = "";
      (r.comments||[]).forEach(c => {
        const commentDiv = document.createElement("div");
        commentDiv.className = "comment";
        commentDiv.innerHTML = `${c.support?'<span class="badge">Support</span>':''}${c.text} - <i>${c.username}</i>`;
        commentsDiv.appendChild(commentDiv);
      });
    });
  }

  function addComment(reportId) {
    const text = prompt("Enter your comment:").trim();
    if(!text) return;
    const username = prompt("Enter your username:").trim() || "Anonymous";
    const isSupport = supportUsers.includes(username);

    const comment = {text, username, support:isSupport};
    db.ref(`reports/${reportId}/comments`).once('value').then(snapshot => {
      const comments = snapshot.val()||[];
      comments.push(comment);
      db.ref(`reports/${reportId}/comments`).set(comments);
    });
  }

  // ===== Admin =====
  function loginAdmin() {
    const code = document.getElementById("adminCode").value;
    if(code==="6118") {
      isAdmin = true;
      document.getElementById("adminPanel").style.display="block";
      renderReports();
      alert("Admin access granted!");
    } else {
      alert("Wrong admin code!");
    }
  }

  function getSelectedReports() {
    const checkboxes = document.querySelectorAll(".selectReport");
    return Array.from(checkboxes)
      .filter(cb=>cb.checked)
      .map(cb=>cb.dataset.id);
  }

  function markSelected(status) {
    if(!isAdmin) return alert("Admin access required!");
    const selected = getSelectedReports();
    selected.forEach(id => db.ref(`reports/${id}/status`).set(status));
  }

  function deleteSelected() {
    if(!isAdmin) return alert("Admin access required!");
    const selected = getSelectedReports();
    selected.forEach(id => db.ref(`reports/${id}`).remove());
  }

</script>
</body>
</html>
