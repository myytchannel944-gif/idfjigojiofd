<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TSG Support</title>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
 font-family:Inter;
 background:linear-gradient(135deg,#0f172a,#020617);
 color:white;
}

/* SIDEBAR */
.sidebar{
 position:fixed;width:250px;height:100%;
 backdrop-filter:blur(15px);
 background:rgba(2,6,23,0.7);
 padding:20px;
 border-right:1px solid rgba(255,255,255,0.05);
}

.logo{font-size:22px;font-weight:600;margin-bottom:30px}

.nav button{
 width:100%;
 padding:12px;
 margin-bottom:10px;
 border:none;
 border-radius:10px;
 background:none;
 color:#94a3b8;
 cursor:pointer;
 transition:.2s;
}

.nav button.active,
.nav button:hover{
 background:rgba(59,130,246,0.2);
 color:#fff;
}

/* MAIN */
.main{
 margin-left:260px;
 padding:25px;
 animation:fade .4s;
}

.header{
 font-size:26px;
 margin-bottom:20px;
 display:flex;
 justify-content:space-between;
 align-items:center;
}

/* STATS */
.grid{
 display:grid;
 grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
 gap:15px;
 margin-bottom:20px;
}

.stat{
 background:rgba(30,41,59,0.6);
 padding:15px;
 border-radius:12px;
 text-align:center;
 backdrop-filter:blur(10px);
}

/* CARD */
.card{
 background:rgba(30,41,59,0.6);
 padding:20px;
 border-radius:12px;
 margin-bottom:15px;
 backdrop-filter:blur(10px);
 transition:.2s;
 cursor:pointer;
}
.card:hover{
 transform:translateY(-5px);
 box-shadow:0 10px 30px rgba(0,0,0,0.4);
}

/* INPUT */
input,textarea{
 width:100%;
 padding:12px;
 margin-top:10px;
 border:none;
 border-radius:10px;
 background:#0f172a;
 color:white;
}

button{
 margin-top:10px;
 padding:10px;
 border:none;
 border-radius:10px;
 background:#3b82f6;
 color:white;
 cursor:pointer;
}

/* STATUS */
.status{font-weight:600}
.open{color:#ef4444}
.progress{color:#f59e0b}
.resolved{color:#22c55e}

.badge{
 background:#22c55e;
 padding:3px 8px;
 border-radius:6px;
 font-size:12px;
 margin-left:6px;
}

/* MODAL */
.modal{
 position:fixed;
 top:0;left:0;
 width:100%;height:100%;
 background:rgba(0,0,0,0.6);
 display:none;
 justify-content:center;
 align-items:center;
}

.modal-content{
 width:500px;
 background:#1e293b;
 padding:20px;
 border-radius:12px;
}

/* COMMENTS */
.comment{
 background:#0f172a;
 padding:8px;
 margin-top:5px;
 border-radius:8px;
}

/* TOAST */
.toast{
 position:fixed;
 bottom:20px;
 right:20px;
 background:#3b82f6;
 padding:10px 15px;
 border-radius:8px;
 opacity:0;
 transition:.3s;
}

/* ANIM */
@keyframes fade{
 from{opacity:0;transform:translateY(10px)}
 to{opacity:1}
}
</style>
</head>

<body>

<div class="sidebar">
 <div class="logo">TSG Support</div>
 <div class="nav">
  <button onclick="nav('home',this)" class="active">Dashboard</button>
  <button onclick="nav('reports',this)">Reports</button>
  <button onclick="nav('admin',this)">Admin</button>
 </div>
</div>

<div class="main">

<div id="home">
 <div class="header">Dashboard</div>

 <div class="grid">
  <div class="stat" id="total">0 Reports</div>
  <div class="stat" id="open">0 Open</div>
  <div class="stat" id="resolved">0 Resolved</div>
 </div>

 <div class="card">
  <h3>Create Report</h3>
  <input id="user" placeholder="Username">
  <textarea id="text" placeholder="Describe issue"></textarea>
  <button onclick="submit()">Submit</button>
 </div>
</div>

<div id="reports" style="display:none">
 <div class="header">Reports</div>
 <div id="list"></div>
</div>

<div id="admin" style="display:none">
 <div class="header">Admin</div>
 <input id="code" placeholder="Admin Code">
 <button onclick="login()">Login</button>
 <div id="adminBox" style="display:none">Admin Enabled</div>
</div>

</div>

<!-- MODAL -->
<div id="modal" class="modal">
 <div class="modal-content">
  <h3 id="mUser"></h3>
  <p id="mText"></p>
  <div id="mComments"></div>
  <input id="cUser" placeholder="Username">
  <input id="cText" placeholder="Comment">
  <button onclick="sendComment()">Send</button>
  <button onclick="closeModal()">Close</button>
 </div>
</div>

<div id="toast" class="toast"></div>

<script>
// FIREBASE
const firebaseConfig={
 apiKey:"AIzaSyCPIfra8YuSnh9C5NbglpRdg4KE5aigHDI",
 authDomain:"support-32682.firebaseapp.com",
 projectId:"support-32682"
};
firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let admin=false;
let currentID=null;
const support=["timmy","admin","support"];

// NAV
function nav(page,btn){
 document.querySelectorAll(".main > div").forEach(d=>d.style.display="none");
 document.getElementById(page).style.display="block";
 document.querySelectorAll(".nav button").forEach(b=>b.classList.remove("active"));
 btn.classList.add("active");
}

// TOAST
function toast(msg){
 let t=document.getElementById("toast");
 t.innerText=msg;
 t.style.opacity=1;
 setTimeout(()=>t.style.opacity=0,2000);
}

// SUBMIT
function submit(){
 let user=document.getElementById("user").value||"Anonymous";
 let text=document.getElementById("text").value;
 if(!text)return;

 localStorage.user=user;

 db.collection("reports").add({
  user,text,status:"open",
  support:support.includes(user),
  comments:[]
 });

 toast("Report created");
}

// LOAD
db.collection("reports").onSnapshot(snap=>{
 let html="";
 let total=0,open=0,res=0;

 snap.forEach(doc=>{
  let r=doc.data();
  total++;

  if(r.status==="open")open++;
  if(r.status==="resolved")res++;

  let cls="open";
  if(r.status==="in progress")cls="progress";
  if(r.status==="resolved")cls="resolved";

  html+=`
  <div class="card" onclick="openModal('${doc.id}')">
   <b>${r.user}</b> ${r.support?'<span class="badge">Support</span>':''}
   <div class="${cls}">${r.status}</div>
   <p>${r.text}</p>
  </div>`;
 });

 document.getElementById("list").innerHTML=html;
 document.getElementById("total").innerText=total+" Reports";
 document.getElementById("open").innerText=open+" Open";
 document.getElementById("resolved").innerText=res+" Resolved";
});

// MODAL
function openModal(id){
 currentID=id;
 db.collection("reports").doc(id).get().then(d=>{
  let r=d.data();
  document.getElementById("modal").style.display="flex";
  document.getElementById("mUser").innerText=r.user;
  document.getElementById("mText").innerText=r.text;

  let cHTML="";
  (r.comments||[]).forEach(c=>{
   cHTML+=`<div class="comment">${c.user}: ${c.text}</div>`;
  });

  document.getElementById("mComments").innerHTML=cHTML;
 });
}

function closeModal(){
 document.getElementById("modal").style.display="none";
}

// COMMENT
function sendComment(){
 let user=document.getElementById("cUser").value;
 let text=document.getElementById("cText").value;
 if(!text)return;

 let ref=db.collection("reports").doc(currentID);
 ref.get().then(d=>{
  let c=d.data().comments||[];
  c.push({user,text});
  ref.update({comments:c});
  toast("Comment added");
  openModal(currentID);
 });
}

// ADMIN
function login(){
 if(document.getElementById("code").value==="6118"){
  admin=true;
  toast("Admin enabled");
 }
}
</script>

</body>
</html>
