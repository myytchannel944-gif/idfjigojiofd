<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>TSG Support - Final Boss 3.0</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}
body{display:flex;min-height:100vh;background:#0b0f1a;color:white;overflow:hidden;}
.sidebar{width:250px;background:#0f1424;padding:20px;display:flex;flex-direction:column;transition:0.3s;}
.sidebar h2{margin-bottom:20px;}
.sidebar button{width:100%;margin:5px 0;padding:12px;background:#12172b;border:none;color:white;border-radius:8px;cursor:pointer;text-align:left;font-weight:600;}
.sidebar button:hover{background:#5865F2;}
.main{flex:1;padding:20px;overflow:auto;}
.topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.card{background:#12172b;padding:20px;border-radius:15px;margin-bottom:15px;transition:0.3s;animation:fadeIn 0.4s;}
.card:hover{transform:translateY(-5px);}
@keyframes fadeIn{from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
input,textarea,select{width:100%;padding:10px;margin:6px 0;background:#0f1424;border:none;color:white;border-radius:8px;}
.mainbtn{background:#5865F2;border:none;padding:10px;width:100%;border-radius:8px;cursor:pointer;font-weight:600;}
.status{padding:4px 8px;border-radius:6px;font-size:12px;}
.open{background:red;}
.progress{background:orange;}
.done{background:green;}
.comment{background:#0f1424;padding:8px;border-radius:8px;margin-top:6px;}
.badge{background:#5865F2;padding:2px 6px;font-size:10px;border-radius:6px;margin-left:5px;}
.page{display:none;}
.active{display:block;}
.toast{position:fixed;bottom:20px;right:20px;background:#5865F2;padding:12px 20px;border-radius:10px;animation:slide 0.3s;z-index:999;}
@keyframes slide{from{transform:translateX(100px);opacity:0;}to{transform:translateX(0);opacity:1;}}
@media(max-width:768px){.sidebar{width:60px;padding:10px;} .sidebar h2{display:none;} .sidebar button{text-align:center;padding:8px;}}
</style>
</head>

<body>

<div class="sidebar">
  <h2>TSG Support</h2>
  <button onclick="showPage('dashboard')">Dashboard</button>
  <button onclick="showPage('create')">Create Report</button>
  <button onclick="showPage('stats')">Stats</button>
  <button onclick="adminLogin()">Admin</button>
</div>

<div class="main">

<div id="login" class="card">
  <h2>Login</h2>
  <input id="username" placeholder="Enter your username">
  <button class="mainbtn" onclick="login()">Login</button>
</div>

<div id="dashboard" class="page"></div>

<div id="create" class="page">
  <div class="card">
    <input id="name" placeholder="Your name">
    <input id="search" placeholder="Search reports..." oninput="filterReports()">
    <select id="type">
      <option>Bug</option>
      <option>Report</option>
      <option>Question</option>
    </select>
    <textarea id="message" placeholder="Describe your issue"></textarea>
    <button class="mainbtn" onclick="createReport()">Submit</button>
  </div>
</div>

<div id="stats" class="page">
  <div class="card">
    <h2>Stats</h2>
    <p id="total"></p>
    <p id="open"></p>
    <p id="progress"></p>
    <p id="resolved"></p>
  </div>
</div>

</div>

<div id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
/* FIREBASE CONFIG */
firebase.initializeApp({
  apiKey: "AIzaSyCPIfra8YuSnh9C5NbglpRdg4KE5aigHDI",
  authDomain: "support-32682.firebaseapp.com",
  databaseURL: "https://support-32682-default-rtdb.firebaseio.com",
  projectId: "support-32682",
  storageBucket: "support-32682.firebasestorage.app",
  messagingSenderId: "911974697786",
  appId: "1:911974697786:web:ac226eb90c19af72dbde03"
});

var db = firebase.database();
var admin=false;
var user="";
var allReports=[];

/* NAV */
function showPage(p){
  document.querySelectorAll(".page").forEach(x=>x.classList.remove("active"));
  document.getElementById(p).classList.add("active");
}

/* LOGIN */
function login(){
  user=document.getElementById("username").value;
  if(!user){alert("Enter username"); return;}
  document.getElementById("login").style.display="none";
  showPage("dashboard");
  toast("Logged in as "+user);
}

/* ADMIN */
function adminLogin(){
  var code=prompt("Enter admin code");
  if(code==="6118"){admin=true; toast("Admin mode enabled");}
  else{toast("Incorrect code");}
}

/* CREATE REPORT */
function createReport(){
  var name=document.getElementById("name").value;
  var type=document.getElementById("type").value;
  var message=document.getElementById("message").value;
  if(!name || !message){toast("Fill in all fields"); return;}
  db.ref("reports").push({name,type,message,status:"open"});
  toast("Report submitted");
  document.getElementById("message").value="";
}

/* LOAD REPORTS */
db.ref("reports").on("value", snap=>{
  allReports=[];
  var container=document.getElementById("dashboard");
  container.innerHTML="";
  var total=0, open=0, progress=0, done=0;

  snap.forEach(child=>{
    var d=child.val(); d.id=child.key; allReports.push(d);

    total++;
    if(d.status==="open") open++;
    if(d.status==="progress") progress++;
    if(d.status==="done") done++;

    var html=`<div class="card">
      <h3>${d.type}</h3>
      <p>${d.message}</p>
      <small>${d.name}</small><br>
      <span class="status ${d.status}">${d.status}</span>`;

    if(admin){
      html+=`<br><br>
      <button onclick="setStatus('${d.id}','progress')">In Progress</button>
      <button onclick="setStatus('${d.id}','done')">Resolved</button>`;
    }

    html+=`<div>`;
    if(d.comments){Object.values(d.comments).forEach(c=>{
      html+=`<div class="comment">${c.text} - ${c.user}${c.support?'<span class="badge">SUPPORT</span>':''}</div>`;
    });}
    html+=`<input id="c_${d.id}" placeholder="Comment"><button onclick="comment('${d.id}')">Send</button></div></div>`;
    container.innerHTML+=html;
  });

  document.getElementById("total").innerText="Total reports: "+total;
  document.getElementById("open").innerText="Open: "+open;
  document.getElementById("progress").innerText="In Progress: "+progress;
  document.getElementById("resolved").innerText="Resolved: "+done;
});

/* FILTER */
function filterReports(){
  var q=document.getElementById("search").value.toLowerCase();
  render(allReports.filter(r=>r.message.toLowerCase().includes(q)));
}
function render(list){
  var container=document.getElementById("dashboard");
  container.innerHTML="";
  list.forEach(d=>{
    var html=`<div class="card">
      <h3>${d.type}</h3>
      <p>${d.message}</p>
      <small>${d.name}</small><br>
      <span class="status ${d.status}">${d.status}</span>`;
    if(admin){html+=`<br><br>
      <button onclick="setStatus('${d.id}','progress')">In Progress</button>
      <button onclick="setStatus('${d.id}','done')">Resolved</button>`;}
    html+=`<div>`;
    if(d.comments){Object.values(d.comments).forEach(c=>{
      html+=`<div class="comment">${c.text} - ${c.user}${c.support?'<span class="badge">SUPPORT</span>':''}</div>`;
    });}
    html+=`<input id="c_${d.id}" placeholder="Comment"><button onclick="comment('${d.id}')">Send</button></div></div>`;
    container.innerHTML+=html;
  });
}

/* STATUS */
function setStatus(id,s){db.ref("reports/"+id).update({status:s}); toast("Status updated");}

/* COMMENT */
function comment(id){
  var text=document.getElementById("c_"+id).value;
  if(!text) return;
  db.ref("reports/"+id+"/comments").push({text,user,support:admin});
  toast("Comment sent");
  document.getElementById("c_"+id).value="";
}

/* TOAST NOTIFICATIONS */
function toast(msg){
  var t=document.createElement("div");
  t.className="toast";
  t.innerText=msg;
  document.body.appendChild(t);
  setTimeout(()=>t.remove(),2000);
}
</script>
</body>
</html>
